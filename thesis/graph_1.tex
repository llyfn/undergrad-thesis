\begin{tikzpicture}[node distance=.7cm]

    % --- Input Data ---
    \node (input) [block] {Batch of Labeled Inputs \\ \scriptsize(\texttt{context [SEP] response}, label)};

    % --- RoBERTa Encoder ---
    \node (encoder) [block, right=of input] {RoBERTa Encoder \\ \scriptsize(Mean Pooled)};
    \draw [main_arrow] (input) -- (encoder);

    % --- Embedding Space ---
    \node (emb_space) [space, right=1.5cm of encoder] {};
    \node [anchor=north] at (emb_space.south) {\scriptsize{Embedding Space}};
    \draw [main_arrow] (encoder) -- (emb_space) node [midway, above, font=\scriptsize] {Normalize};

    % --- Coordinates for Clusters ---
    \coordinate (c1) at ($(emb_space.center)+(-0.8, 1.2)$);
    \coordinate (c2) at ($(emb_space.center)+(1.0, -1.2)$);

    % --- Sarcastic Embeddings ---
    \node[sarc_emb] (s1) at (c1) {};
    \node[sarc_emb] (s2) at ($(c1)+(-0.5,-0.1)$) {};
    \node[sarc_emb, label={[font=\tiny]right:$h_{sarc}$}] (s3) at ($(c1)+(-0.1,-0.5)$) {};

    % --- Non-Sarcastic Embeddings ---
    \node[norm_emb] (n1) at (c2) {};
    \node[norm_emb] (n2) at ($(c2)+(0.5,0.1)$) {};
    \node[norm_emb, label={[font=\tiny]left:$h_{norm}$}] (n3) at ($(c2)+(0.1,0.5)$) {};

    % --- Force arrows ---
    \draw[force_arrow, black, bend right=40] (s1) to node[midway, above, font=\tiny] {attract} (s2);
    \draw[force_arrow, black, bend right=40] (n1) to node[midway, below, font=\tiny] {attract} (n2);
    \draw[force_arrow, black, <->] (s3) to node[midway, above, sloped, font=\tiny] {repel} (n3);

    % --- Loss Function ---
    \node (loss) [block, right=of emb_space] {Supervised Contrastive Loss \\ $\mathcal{L}_{\text{SupCon}}$};
    \draw [main_arrow] (emb_space) -- (loss);

    % --- Weight Update Path ---
    \draw [update_arrow] (loss.north) -- ++(0,+1.5) -| (encoder.north)
    node [pos=0.25, below, font=\scriptsize] {Update Encoder Weights};

\end{tikzpicture}